---
title: "08_logistic_regression.qmd"
author: "Group12"
format: html
editor: visual
---

## Logistic regression

## Clear environment

```{r}
# | echo: true 
# | eval: true  

rm(list = ls())
```

## Load libraries

```{r}
# | echo: true 
# | eval: true  

library(tidyverse)
library(ggfortify)

```

## Load data

```{r}
# | echo: true 
# | eval: true 

body_measurements <- read_tsv(file = "../data/PCOS_body_measurements_aug.tsv")
blood_measurements <- read_tsv(file = "../data/PCOS_blood_measurements_aug.tsv")

# verifying column names
colnames(blood_measurements)
```

## Logistic regression

From previous analysis, the follicle number and size seems slight important for individuals with PCOS diagnosis compared to individuals without. Out of curiosity we wanted to see if we could perform a linear regression model on a subset of the data

```{r}
# | echo: true 
# | eval: true 

# logistic regression model for all paramters related to follicles size of number

model_follicle <- glm(as.factor(PCOS_diagnosis) ~ follicle_no_R + follicle_no_L + avg_fsize_R + avg_fsize_L, 
          family = "binomial",
          data = body_measurements)


summary(model_follicle)
plot(model_follicle)


```

Now we see that for number of follicles to the right and left, both have a low p-value, showing significant importance of the individuals with PCOS. However the size does not seem very important.

```{r}
# | echo: true 
# | eval: true 




avg_fsize_R_range <- seq(min(body_measurements$avg_fsize_R), max(body_measurements$avg_fsize_R), length.out = 100)
new_data <- data.frame(
  follicle_no_R = mean(body_measurements$follicle_no_R),
  follicle_no_L = mean(body_measurements$follicle_no_L),
  avg_fsize_R = avg_fsize_R_range,
  avg_fsize_L = mean(body_measurements$avg_fsize_L)
)
probs <- predict(model_follicle, newdata = new_data, type = "response")
```

We will know try to predict on the binary data for follicle no to the right and left retrospectively

```{r}
# | echo: true 
# | eval: true 

#defining the range of follicles to right and left respectivally
range(body_measurements$follicle_no_R)
# results is 0-22
range(body_measurements$follicle_no_L)
#results is 0-20

# defining the sequence
follicle_R <- seq(0, 22, 1)
follicle_L <- seq(0, 20, 1)

# performing the model for each senario
model_follicle_R <- glm(as.factor(PCOS_diagnosis) ~ follicle_no_R, data = body_measurements, family = "binomial")
model_follicle_L <- glm(as.factor(PCOS_diagnosis) ~ follicle_no_L, data = body_measurements, family = "binomial")

# use the function predict, to a model for values in each sequence
predict_follicle_R <- predict(model_follicle_R, list(follicle_no_R = follicle_R), ,type="response")
predict_follicle_L <- predict(model_follicle_L, list(follicle_no_L = follicle_L), ,type="response")

# plotting the right side
lm_plot_R <- body_measurements |>
   ggplot(mapping = aes(x = follicle_no_R, 
                        y = PCOS_diagnosis)) +
   stat_smooth(method = "glm",
               formula = y ~ x,
               color = "pink") +
   geom_point(alpha = 0.5, color = "purple") +
   labs(title = "Logistic Regression Model",
        x = "Follicle number (R)",
        y = "PCOS diagnosis (Yes/no)") +
   theme_minimal()

lm_plot_R

# Saving the plot as a picture
ggsave(lm_plot_R,
       filename = "../results/08_lm_plot_R.png",
       device = "png",
       height = 20,
       width = 20,
       units = "cm")

# plotting the left side
lm_plot_L <- body_measurements |>
   ggplot(mapping = aes(x = follicle_no_L, 
                        y = as.factor(PCOS_diagnosis))) +
   stat_smooth(method = "glm",
               formula = y ~ x,
               color = "pink") +
   geom_point(alpha = 0.5, color = "purple") +
   labs(title = "Logistic Regression Model",
        x = "Follicle number (L)",
        y = "PCOS diagnosis (Yes/no)") +
   theme_minimal()

lm_plot_L

# Saving the plot as a picture
ggsave(lm_plot_L,
       filename = "../results/08_lm_plot_L.png",
       device = "png",
       height = 20,
       width = 20,
       units = "cm")

```

Now we want to test, if the difference between number of follicles in right and left, has any significance.

```{r}
# | echo: true 
# | eval: true 

body_measurements <- body_measurements |>
  mutate(follicle_no_diff = follicle_no_R - follicle_no_L)

lm_diff <- glm(as.factor(PCOS_diagnosis) ~ follicle_no_diff, 
               family = "binomial",
               data = body_measurements)

summary(lm_diff)
plot(lm_diff)


```

There is no significant difference between the number of follicles to the left and right

```{r}
# | echo: true 
# | eval: true 

### number of follicles to the right

# making a dataframe for PCOS patients
PCOS_patients <- body_measurements |>
  select(follicle_no_R, PCOS_diagnosis, patient_ID) |>
  filter(PCOS_diagnosis == "Yes") |>
  mutate(PCOS_follicles_no = follicle_no_R) |>
  select(- follicle_no_R)
  
# making a dataframe for non PCOS patients
nonPCOS_patients <- body_measurements |>
  select(follicle_no_R, PCOS_diagnosis, patient_ID) |>
  filter(PCOS_diagnosis == "No") |>
  mutate(nonPCOS_follicles_no = follicle_no_R) |>
  select(- follicle_no_R)

follicle_R_dataframe <- bind_rows(nonPCOS_patients, PCOS_patients) |>
  replace_na(list(nonPCOS_follicles_no = 0, PCOS_follicles_no = 0))

# trying to make the model
lm_follicle_R <- lm(nonPCOS_follicles_no ~ PCOS_follicles_no, 
            data = follicle_R_dataframe)

summary(lm_follicle_R)
plot(lm_follicle_R)

### number of follicles to the left

# making a dataframe for PCOS patients
PCOS_patients <- body_measurements |>
  select(follicle_no_L, PCOS_diagnosis, patient_ID) |>
  filter(PCOS_diagnosis == "Yes") |>
  mutate(PCOS_follicles_no = follicle_no_L) |>
  select(- follicle_no_L)
  
# making a dataframe for non PCOS patients
nonPCOS_patients <- body_measurements |>
  select(follicle_no_L, PCOS_diagnosis, patient_ID) |>
  filter(PCOS_diagnosis == "No") |>
  mutate(nonPCOS_follicles_no = follicle_no_L) |>
  select(- follicle_no_L)

follicle_L_dataframe <- bind_rows(nonPCOS_patients, PCOS_patients) |>
  replace_na(list(nonPCOS_follicles_no = 0, PCOS_follicles_no = 0))

# trying to make the model
lm_follicle_L <- lm(nonPCOS_follicles_no ~ PCOS_follicles_no, 
            data = follicle_L_dataframe)

summary(lm_follicle_L)
plot(lm_follicle_L)

```

Here we see a significant difference in both cases, showing that the number of follicles between PCOS and non-PCOS patients withholds importance
